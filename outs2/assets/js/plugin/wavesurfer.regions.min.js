/*! wavesurfer.js 1.1.2 (Sun, 15 May 2016 09:37:59 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license CC-BY-3.0 */!function(e,t){"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof exports?module.exports=t(require("wavesurfer.js")):t(WaveSurfer)}(this,function(e){"use strict";e.Regions={init:function(e){this.wavesurfer=e,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(t){var i=Object.create(e.Region);return i.init(t,this.wavesurfer),this.list[i.id]=i,i.on("remove",function(){delete this.list[i.id]}.bind(this)),i},clear:function(){Object.keys(this.list).forEach(function(e){this.list[e].remove()},this)},enableDragSelection:function(e){function t(e){r=!0,"undefined"!=typeof e.targetTouches&&1===e.targetTouches.length&&(e.clientX=e.targetTouches[0].clientX),s=o.wavesurfer.drawer.handleEvent(e),a=null}function i(e){r=!1,a&&(a.fireEvent("update-end",e),o.wavesurfer.fireEvent("region-update-end",a,e)),a=null}function n(t){if(r){a||(a=o.add(e||{}));var i=o.wavesurfer.getDuration();"undefined"!=typeof t.targetTouches&&1===t.targetTouches.length&&(t.clientX=t.targetTouches[0].clientX);var n=o.wavesurfer.drawer.handleEvent(t);a.update({start:Math.min(n*i,s*i),end:Math.max(n*i,s*i)})}}var r,s,a,o=this;this.wrapper.addEventListener("mousedown",t),this.wrapper.addEventListener("touchstart",t),this.on("disable-drag-selection",function(){o.wrapper.removeEventListener("touchstart",t),o.wrapper.removeEventListener("mousedown",t)}),this.wrapper.addEventListener("mouseup",i),this.wrapper.addEventListener("touchend",i),this.on("disable-drag-selection",function(){o.wrapper.removeEventListener("touchend",i),o.wrapper.removeEventListener("mouseup",i)}),this.wrapper.addEventListener("mousemove",n),this.wrapper.addEventListener("touchmove",n),this.on("disable-drag-selection",function(){o.wrapper.removeEventListener("touchmove",n),o.wrapper.removeEventListener("mousemove",n)})},disableDragSelection:function(){this.fireEvent("disable-drag-selection")}},e.util.extend(e.Regions,e.Observer),e.Region={style:e.Drawer.style,init:function(t,i){this.wavesurfer=i,this.wrapper=i.drawer.wrapper,this.id=null==t.id?e.util.getId():t.id,this.start=Number(t.start)||0,this.end=null==t.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(t.end),this.resize=void 0===t.resize||Boolean(t.resize),this.drag=void 0===t.drag||Boolean(t.drag),this.loop=Boolean(t.loop),this.color=t.color||"rgba(0, 0, 0, 0.1)",this.data=t.data||{},this.attributes=t.attributes||{},this.maxLength=t.maxLength,this.minLength=t.minLength,this.bindInOut(),this.render(),this.wavesurfer.on("zoom",this.updateRender.bind(this)),this.wavesurfer.fireEvent("region-created",this)},update:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this.updateRender.bind(this)),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var e=document.createElement("region");e.className="wavesurfer-region",e.title=this.formatTime(this.start,this.end),e.setAttribute("data-id",this.id);for(var t in this.attributes)e.setAttribute("data-region-"+t,this.attributes[t]);if(this.wrapper.scrollWidth,this.style(e,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var i=e.appendChild(document.createElement("handle")),n=e.appendChild(document.createElement("handle"));i.className="wavesurfer-handle wavesurfer-handle-start",n.className="wavesurfer-handle wavesurfer-handle-end";var r={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(i,r),this.style(n,r),this.style(n,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)},formatTime:function(e,t){return(e==t?[e]:[e,t]).map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")}).join("-")},updateRender:function(e){var t,i=this.wavesurfer.getDuration();if(t=e?Math.round(this.wavesurfer.getDuration()*e):this.wrapper.scrollWidth,this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>i&&(this.end=i,this.start=i-(this.end-this.start)),null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end)),null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end)),null!=this.element){this.style(this.element,{left:~~(this.start/i*t)+"px",width:~~((this.end-this.start)/i*t)+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(var n in this.attributes)this.element.setAttribute("data-region-"+n,this.attributes[n]);this.element.title=this.formatTime(this.start,this.end)}},bindInOut:function(){var e=this;e.firedIn=!1,e.firedOut=!1;var t=function(t){!e.firedOut&&e.firedIn&&(e.start>=Math.round(100*t)/100||e.end<=Math.round(100*t)/100)&&(e.firedOut=!0,e.firedIn=!1,e.fireEvent("out"),e.wavesurfer.fireEvent("region-out",e)),!e.firedIn&&e.start<=t&&e.end>t&&(e.firedIn=!0,e.firedOut=!1,e.fireEvent("in"),e.wavesurfer.fireEvent("region-in",e))};this.wavesurfer.backend.on("audioprocess",t),this.on("remove",function(){e.wavesurfer.backend.un("audioprocess",t)}),this.on("out",function(){e.loop&&e.wavesurfer.play(e.start)})},bindEvents:function(){var e=this;this.element.addEventListener("mouseenter",function(t){e.fireEvent("mouseenter",t),e.wavesurfer.fireEvent("region-mouseenter",e,t)}),this.element.addEventListener("mouseleave",function(t){e.fireEvent("mouseleave",t),e.wavesurfer.fireEvent("region-mouseleave",e,t)}),this.element.addEventListener("click",function(t){t.preventDefault(),e.fireEvent("click",t),e.wavesurfer.fireEvent("region-click",e,t)}),this.element.addEventListener("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent("dblclick",t),e.wavesurfer.fireEvent("region-dblclick",e,t)}),(this.drag||this.resize)&&function(){var t,i,n,r=e.wavesurfer.getDuration(),s=function(s){s.stopPropagation(),n=e.wavesurfer.drawer.handleEvent(s)*r,"handle"==s.target.tagName.toLowerCase()?i=s.target.classList.contains("wavesurfer-handle-start")?"start":"end":t=!0},a=function(n){(t||i)&&(t=!1,i=!1,n.stopPropagation(),n.preventDefault(),e.fireEvent("update-end",n),e.wavesurfer.fireEvent("region-update-end",e,n))},o=function(s){if(t||i){var a=e.wavesurfer.drawer.handleEvent(s)*r,o=a-n;n=a,e.drag&&t&&e.onDrag(o),e.resize&&i&&e.onResize(o,i)}};e.element.addEventListener("mousedown",s),e.wrapper.addEventListener("mousemove",o),document.body.addEventListener("mouseup",a),e.on("remove",function(){document.body.removeEventListener("mouseup",a),e.wrapper.removeEventListener("mousemove",o)}),e.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",a)})}()},onDrag:function(e){this.update({start:this.start+e,end:this.end+e})},onResize:function(e,t){"start"==t?this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}):this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}},e.util.extend(e.Region,e.Observer),e.initRegions=function(){this.regions||(this.regions=Object.create(e.Regions),this.regions.init(this))},e.addRegion=function(e){return this.initRegions(),this.regions.add(e)},e.clearRegions=function(){this.regions&&this.regions.clear()},e.enableDragSelection=function(e){this.initRegions(),this.regions.enableDragSelection(e)},e.disableDragSelection=function(){this.regions.disableDragSelection()}});